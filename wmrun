#!/usr/bin/env bash

: "${wm:=monsterwm}"
: "${ff:="/tmp/${wm}.fifo"}"

while sleep 1; do statusbar
done | dzen2 -h 18 -w 1520 -x 400 -ta r -e -p -fn "-misc-terminusmod.icons-medium-r-normal--12-120-72-72-c-60-*-*" &

[[ -p $ff ]] || mkfifo -m 600 "$ff"
while read -r; do
    [[ $REPLY =~ ^(([[:digit:]]+:)+[[:digit:]]+ ?)+$ ]] && read -ra desktops <<< "$REPLY" || continue
    for desktop in "${desktops[@]}"; do
        IFS=':' read -r d w m c u <<< "$desktop"
        case $d in
            0) d="web" s=""   ;;
            1) d="dev" s="::" ;;
            2) d="foo" s="::" ;;
        esac
        ((c)) && f="#d11783" && case $m in
            0) i="[T]" ;;
            1) i="[M]" ;;
            2) i="[B]" ;;
            3) i="[G]" ;;
        esac  || f="#5e7175"
        ((u)) && f="#ff0000"
        ((w)) && r+="$s ^fg($f)$d $w^fg() " || r+="$s ^fg($f)$d^fg() "
    done
    printf "%s%s\n" "$r" "$i" && unset r
done < "$ff" | dzen2 -h 18 -w 400 -ta l -e -p -fn "-misc-terminusmod.icons-medium-r-normal--12-120-72-72-c-60-*-*" &

while :; do "$wm" || break; done | tee -a "$ff"
